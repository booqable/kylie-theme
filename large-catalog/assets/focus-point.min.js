!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.imageFocus={})}(this,function(t){"use strict";function i(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];return i.forEach(function(i){return Object.keys(i).forEach(function(e){return t[e]=i[e]})}),t}function e(t,i){var e;return function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];clearTimeout(e),e=setTimeout(function(){return t.apply(void 0,n)},i)}}var n={position:"relative",overflow:"hidden"},s={position:"absolute",top:"0",right:"0",bottom:"0",left:"0"},o={display:"block",maxWidth:"100%",touchAction:"none"},a={position:"absolute",cursor:"move",transform:"translate(-50%, -50%)"},r={onChange:function(){},retina:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj4KICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgPGNpcmNsZSBpZD0iYSIgY3g9IjEwIiBjeT0iMTAiIHI9IjEwIiBmaWxsPSIjMDAwIiBmaWxsLW9wYWNpdHk9Ii4zIiAvPgogICAgPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iOSIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utb3BhY2l0eT0iLjgiIHN0cm9rZS13aWR0aD0iMiIvPgogIDwvZz4KPC9zdmc+"},c=function(){function t(t,e){void 0===e&&(e={});var s=this;this.startDragging=function(t){t.preventDefault(),s.isDragging=!0,t instanceof MouseEvent?s.updateCoordinates(t.clientX,t.clientY):s.updateCoordinates(t.touches[0].clientX,t.touches[0].clientY)},this.handleMove=function(t){if(t.preventDefault(),t instanceof MouseEvent)s.updateCoordinates(t.clientX,t.clientY);else{var i=t.touches[0],e=document.elementFromPoint(i.pageX,i.pageY);e!==s.retina&&e!==s.img?s.stopDragging():s.updateCoordinates(i.clientX,i.clientY)}},this.stopDragging=function(){s.isDragging=!1},this.updateRetinaPositionFromFocus=function(){s.updateRetinaPosition(s.calculateOffsetFromFocus())},this.updateRetinaPosition=function(t){s.retina.style.top=t.offsetY+"px",s.retina.style.left=t.offsetX+"px"},this.options=i(r,e),this.img=t,this.container=t.parentElement,this.retina=document.createElement("img"),this.retina.src=this.options.retina,this.retina.draggable=!1,this.container.appendChild(this.retina),this.container.addEventListener("mousedown",this.startDragging),this.container.addEventListener("mousemove",this.handleMove),this.container.addEventListener("mouseup",this.stopDragging),this.container.addEventListener("mouseleave",this.stopDragging),this.container.addEventListener("touchend",this.stopDragging),this.container.addEventListener("touchstart",this.startDragging,{passive:!0}),this.container.addEventListener("touchmove",this.handleMove,{passive:!0}),this.img.draggable=!1,this.img.addEventListener("load",this.updateRetinaPositionFromFocus),i(this.img.style,o),i(this.retina.style,a),i(this.container.style,n),this.focus=this.options.focus?this.options.focus:{x:parseFloat(this.img.getAttribute("data-focus-x"))||0,y:parseFloat(this.img.getAttribute("data-focus-y"))||0},this.setFocus(this.focus)}return t.prototype.setFocus=function(t){this.focus=t,this.img.setAttribute("data-focus-x",t.x.toString()),this.img.setAttribute("data-focus-y",t.y.toString()),this.updateRetinaPositionFromFocus(),this.options.onChange(t)},t.prototype.calculateOffsetFromFocus=function(){var t=this.img.getBoundingClientRect(),i=t.width,e=t.height;return{offsetX:i*(this.focus.x/2+.5),offsetY:e*(this.focus.y/-2+.5)}},t.prototype.updateCoordinates=function(t,i){if(this.isDragging){var e=this.img.getBoundingClientRect(),n=e.width,s=e.height,o=2*((t-e.left)/n-.5),a=-2*((i-e.top)/s-.5);this.setFocus({x:o,y:a})}},t}(),h={minHeight:"100%",minWidth:"100%"},u={height:"100%",width:"100%",border:"none",opacity:0,zIndex:-1,pointerEvents:"none"},d={debounceTime:17,updateOnWindowResize:!0,updateOnContainerResize:!1,containerPosition:"relative"},g=function(){function t(t,o){void 0===o&&(o={});var a=this;this.imageNode=t,this.listening=!1,this.setFocus=function(t){a.focus=t,a.img.setAttribute("data-focus-x",t.x.toString()),a.img.setAttribute("data-focus-y",t.y.toString()),a.applyShift()},this.applyShift=function(){var t=a.img,i=t.naturalWidth,e=t.naturalHeight,n=a.container.getBoundingClientRect(),s=n.width,o=n.height,r="0",c="0";if(!(s>0&&o>0&&i>0&&e>0))return!1;var h=i/s,u=e/o;a.img.style.maxHeight=null,a.img.style.maxWidth=null,i>s&&e>o&&(a.img.style[h>u?"maxHeight":"maxWidth"]="100%"),h>u?r=a.calcShift(u,s,i,a.focus.x)+"%":h<u&&(c=a.calcShift(h,o,e,a.focus.y,!0)+"%"),a.img.style.top=c,a.img.style.left=r},this.options=i(d,o),this.img=t,this.container=t.parentElement,this.img.__focused_image_instance__&&(this.img.__focused_image_instance__.stopListening(),this.img.removeEventListener("load",this.applyShift)),this.img.__focused_image_instance__=this,this.img.addEventListener("load",this.applyShift),i(this.container.style,n),this.container.style.position=this.options.containerPosition,i(this.img.style,h,s),this.debounceApplyShift=e(this.applyShift,this.options.debounceTime),this.focus=this.options.focus?this.options.focus:{x:parseFloat(this.img.getAttribute("data-focus-x"))||0,y:parseFloat(this.img.getAttribute("data-focus-y"))||0},this.startListening(),this.setFocus(this.focus)}return t.prototype.startListening=function(){var t=this;if(!this.listening&&(this.listening=!0,this.options.updateOnWindowResize&&window.addEventListener("resize",this.debounceApplyShift),this.options.updateOnContainerResize)){var e=document.createElement("object");i(e.style,u,s),e.addEventListener("load",function(i){return e.contentDocument.defaultView.addEventListener("resize",function(){return t.debounceApplyShift()})}),e.type="text/html",e.setAttribute("aria-hidden","true"),e.tabIndex=-1,this.container.appendChild(e),e.data="about:blank",this.resizeListenerObject=e}},t.prototype.stopListening=function(){this.listening&&(this.listening=!1,window.removeEventListener("resize",this.debounceApplyShift),this.resizeListenerObject&&(this.resizeListenerObject.contentDocument.defaultView.removeEventListener("resize",this.debounceApplyShift),this.container.removeChild(this.resizeListenerObject),this.resizeListenerObject=null))},t.prototype.calcShift=function(t,i,e,n,s){var o=Math.floor(i/2),a=(n+1)/2,r=Math.floor(e/t),c=Math.floor(a*r);s&&(c=r-c);var h=c-o,u=r-c,d=i-o;return u<d&&(h-=d-u),h<0&&(h=0),-100*h/i},t}();t.FocusPicker=c,t.FocusedImage=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=image-focus.umd.js.map